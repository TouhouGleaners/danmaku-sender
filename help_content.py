from importlib import metadata


try:
    APP_VERSION = metadata.version("BiliDanmakuSender")
    APP_AUTHOR = metadata.metadata("BiliDanmakuSender")['Author']
except metadata.PackageNotFoundError:
    APP_VERSION = "0.0.0-dev"
    APP_AUTHOR = "Miku_oso"

# --- 窗口标题常量 ---
MAIN_WINDOW_TITLE_PREFIX = "B站弹幕补档工具"
HELP_WINDOW_TITLE = "使用说明"
ABOUT_WINDOW_SHORT_TITLE = "关于"

# --- 弹幕发射器帮助文本 ---
SENDER_HELP_TEXT = """
【SESSDATA/BILI_JCT 获取】
1.  在浏览器（推荐Chrome/Edge）中登录Bilibili。
2.  访问任意B站页面，按F12打开“开发者工具”。
3.  切换到 "应用程序"(Application) 标签页。
4.  在左侧菜单中，找到 "存储"(Storage) -> "Cookies" -> "https://www.bilibili.com"。
5.  复制 SESSDATA 和 BILI_JCT 的 "值"(Value) 列内容，粘贴到本工具对应的输入框。
--------------------
【BV号】
输入你要发送弹幕的视频BV号（B站视频页面URL中以“BV”开头的部分）。
--------------------
【获取分P】
点击此按钮获取视频的所有分P列表。
成功后，你可以在“选择分P”下拉框中选择目标分P。
--------------------
【选择弹幕文件】
点击按钮选择本地XML格式的弹幕文件（通常从Bilibili下载）。
文件选择后，工具会自动解析弹幕，如果有误会给出提示。
--------------------
【最小延迟/最大延迟】
设置发送每条弹幕之间的随机延迟时间（秒）。
这样做是为了避免因发送过快被B站限制。
建议设置为20-25秒，或根据实际情况调整。
--------------------
【开始任务 / 紧急停止】
点击“开始任务”启动弹幕发送。
任务进行中按钮会变为“紧急停止”，点击可提前终止任务。
"""


# --- 弹幕校验器帮助文本 ---
VALIDATOR_HELP_TEXT = """
【弹幕校验器功能概述】
此功能用于检查本地弹幕文件中的弹幕是否符合B站的发送规范。
它会识别出可能导致发送失败的弹幕（如内容过长、包含换行符、时间戳超出视频总时长等）。
您可以直接在这里编辑问题弹幕的内容，或删除不希望发送的弹幕。
--------------------
【使用步骤】
1.  在“弹幕发射器”标签页：
    -   填写SESSDATA和BILI_JCT凭证（并非强制，但若要校验时间戳则需要绑定视频）。
    -   输入目标视频的BV号，然后点击“获取分P并选择一个分P”（需要视频时长来校验时间戳）。
    -   点击“选择文件”按钮，加载您想要进行校验的本地弹幕XML文件。
    （重要提示：这些信息会自动同步到校验器标签页）。
2.  回到“弹幕校验器”标签页：
    -   确认已在“发射器”页面加载了弹幕文件并选择了分P。
    -   点击“开始验证”按钮。工具将列出所有发现的问题弹幕。
3.  处理问题弹幕：
    -   编辑弹幕内容:
        双击“弹幕内容”列的单元格，可以直接修改弹幕文本。
        修改后点击回车键或将焦点移出即可保存。

    -   删除弹幕:
        选择一个或多个有问题的弹幕条目，然后点击“删除选中条目”按钮。
        这些弹幕将从问题列表中移除，并在应用修改后不会被发送。

    -   应用修改:
        完成所有处理后，点击“应用所有修改”按钮。
        所有合法弹幕、以及您已修改或未删除的问题弹幕，将形成新的发送队列。
        被删除的弹幕将不会被包含在下次发射队列中。
--------------------
【校验规则】
-   内容过长: 弹幕内容不能超过100个字符。
-   包含换行符: 弹幕内容不能包含换行符（\\n 或 /n）。
-   时间戳超限: 弹幕的发送时间（progress）不能超过视频的总时长。
"""


# --- 弹幕监视器帮助文本 ---
MONITOR_HELP_TEXT = """
【弹幕监视器功能概述】
此功能用于监视B站视频指定分P的实时弹幕。
它会尝试将在线弹幕与您提供的本地弹幕文件进行匹配。
--------------------
【使用步骤】
1.  在“弹幕发射器”标签页：
    -   填写SESSDATA和BILI_JCT凭证。
    -   输入目标视频的BV号，然后点击“获取分P”并选择一个分P。
    -   点击“选择文件”按钮，加载您想要进行匹配的本地弹幕XML文件。
    （重要提示：这些信息会自动同步到监视器标签页）。

2.  回到“弹幕监视器”标签页：
    -   确认“当前视频”、“当前分P”和“当前文件”信息是否正确。
    -   根据需要调整“检查间隔(秒)”：这是工具轮询B站在线弹幕的频率。
    -   根据需要调整“时间容差(ms)”：这是本地弹幕与在线弹幕时间戳允许的最大差异。
        （例如，设为500ms意味着前后0.5秒内的弹幕都可匹配）。

3.  点击“开始监视”按钮：
    监视器将开始周期性获取在线弹幕，并尝试与本地弹幕进行匹配。
    匹配到的弹幕会在日志中显示，进度条也会更新。
--------------------
【注意事项】
-   “弹幕发射器”标签页必须先配置好目标视频和本地弹幕文件，监视器才能正常工作。
-   在线弹幕数据会有一定的延迟，可能会影响匹配效率。
-   网络不稳定可能导致获取在线弹幕失败。
"""



# --- 关于我们文本 ---
ABOUT_WINDOW_TITLE = "关于 B站弹幕补档工具"
ABOUT_TEXT_TOP = MAIN_WINDOW_TITLE_PREFIX
ABOUT_TEXT_VERSION = f"版本: {APP_VERSION}"
ABOUT_TEXT_AUTHOR = "作者: Miku_oso"
ABOUT_TEXT_GITHUB_TITLE = "GitHub 仓库:"
ABOUT_TEXT_FEEDBACK = "如果您在使用过程中遇到任何问题或有改进建议，\n请前往 GitHub 仓库的 Issue 页面提交反馈。"
ABOUT_TEXT_ISSUE_LINK_LABEL = ">>> 前往 Issue 页面 <<<"


# --- URL常量 ---
GITHUB_REPO_URL = "https://github.com/TouhouGleaners/danmaku-sender"
GITHUB_ISSUES_URL = f"{GITHUB_REPO_URL}/issues"
